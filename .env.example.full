# ============================================================
# Discoclaw — Complete Environment Reference
# ============================================================
# This is the full reference for all ~90 env vars.
# For quick start, see .env.example (only the essentials).
# ============================================================

# ----------------------------------------------------------
# REQUIRED — the bot won't start without these
# ----------------------------------------------------------

# Your Discord bot token (from https://discord.com/developers/applications)
# Important: You must also enable Message Content Intent in the Discord Developer Portal
# (Bot page → Privileged Gateway Intents). Without it, the bot silently receives empty messages.
DISCORD_TOKEN=

# Comma-separated Discord user IDs allowed to talk to the bot.
# Empty = nobody can use it (fail-closed).
DISCORD_ALLOW_USER_IDS=

# Beads forum channel ID (required when DISCOCLAW_BEADS_ENABLED=1; default on).
DISCOCLAW_BEADS_FORUM=

# Cron forum channel ID (required when DISCOCLAW_CRON_ENABLED=1; default on).
DISCOCLAW_CRON_FORUM=

# ----------------------------------------------------------
# CORE — most users will want to review these
# ----------------------------------------------------------

# Where the Claude CLI runs (its working directory).
# Default: ./workspace (or $DISCOCLAW_DATA_DIR/workspace if DATA_DIR is set)
#WORKSPACE_CWD=

# Primary runtime adapter for bot messages, crons, summaries, and plan execution.
# Valid values: claude | codex | openai
# - openai requires OPENAI_API_KEY
# - claude requires a working Claude CLI
#PRIMARY_RUNTIME=claude

# Model tier: fast | capable (provider-agnostic).
# Concrete model names (e.g. opus, sonnet, gpt-4o) are still accepted as passthrough.
#RUNTIME_MODEL=capable

# Output format for the Claude CLI. stream-json gives smoother streaming.
#CLAUDE_OUTPUT_FORMAT=stream-json

# Allow Claude to run without permission prompts. This is what makes
# headless/Discord operation possible — the Discord allowlist above
# is the security boundary instead.
#CLAUDE_DANGEROUSLY_SKIP_PERMISSIONS=1

# Log level: trace | debug | info | warn | error | fatal
#LOG_LEVEL=info

# ============================================================
# CORE SUBSYSTEMS — enabled by default, configure as needed
# ============================================================

# ----------------------------------------------------------
# Cron — forum-based scheduled tasks (enabled by default)
# ----------------------------------------------------------
# Forum channel ID is configured above in REQUIRED.
# Model tier for cron execution: fast | capable (concrete names accepted as passthrough).
#DISCOCLAW_CRON_MODEL=fast
# Enable cron Discord actions (CRUD via Discord action blocks).
#DISCOCLAW_DISCORD_ACTIONS_CRONS=1
# Persistent stats directory (run counts, last run time, status).
#DISCOCLAW_CRON_STATS_DIR=
# AI auto-tagging for cron purpose + model tier (off until tags bootstrapped).
#DISCOCLAW_CRON_AUTO_TAG=0
#DISCOCLAW_CRON_AUTO_TAG_MODEL=fast
# Runtime tag-map file (seeded from scripts/cron/cron-tag-map.json on first boot).
#DISCOCLAW_CRON_TAG_MAP=
# Set to 0 to disable cron entirely.
#DISCOCLAW_CRON_ENABLED=0

# ----------------------------------------------------------
# Beads — task tracking (enabled by default; requires bd CLI)
# ----------------------------------------------------------
#BD_BIN=bd
#DISCOCLAW_BEADS_CWD=
# Forum channel ID is configured above in REQUIRED.
# Guild ID — required for bead hooks (on-close, on-create, etc.) that run outside the bot process.
# Also used for System channel bootstrap when the bot is in multiple servers.
DISCORD_GUILD_ID=
# Runtime tag-map file (seeded from scripts/beads/bead-hooks/tag-map.json on first boot).
#DISCOCLAW_BEADS_TAG_MAP=
# Skip Phase 5 (thread reconciliation) during bead sync. Useful for shared-forum deployments
# where multiple instances share the same forum and you don't want cross-instance archival.
#BEAD_SYNC_SKIP_PHASE5=0
#DISCOCLAW_BEADS_MENTION_USER=
# When 1 and MENTION_USER set, open beads keep @mention in starter for sidebar visibility; removed on close.
#DISCOCLAW_BEADS_SIDEBAR=0
#DISCOCLAW_BEADS_AUTO_TAG=1
#DISCOCLAW_BEADS_AUTO_TAG_MODEL=fast
# Override with a concrete model name instead of tier resolution (e.g. haiku, gpt-4o-mini).
#DISCOCLAW_BEADS_AUTO_TAG_CONCRETE_MODEL=
# Set to 0 to disable beads entirely.
#DISCOCLAW_BEADS_ENABLED=0

# ============================================================
# OPTIONAL — uncomment sections you need
# ============================================================

# ----------------------------------------------------------
# Channel restrictions
# ----------------------------------------------------------
# Restrict the bot to specific guild channel IDs (comma/space-separated).
# DMs are still allowed. For threads, allowlist the parent channel ID.
#DISCORD_CHANNEL_IDS=
# Require a channel-context file to exist before responding in a channel.
#DISCORD_REQUIRE_CHANNEL_CONTEXT=1
# Auto-create channel context scaffold on first message in a new channel.
#DISCORD_AUTO_INDEX_CHANNEL_CONTEXT=1
# Auto-join threads so the bot can respond inside them.
# Note: private threads still require manually adding the bot.
#DISCORD_AUTO_JOIN_THREADS=0

# ----------------------------------------------------------
# Reaction handler (trigger AI via emoji reactions)
# ----------------------------------------------------------
# Master switch — when enabled, reacting to a message with any emoji
# triggers the AI to respond to that message (allowlist still applies).
#DISCOCLAW_REACTION_HANDLER=0
# Ignore reactions on messages older than this many hours (prevents
# accidental triggers when scrolling through old history).
#DISCOCLAW_REACTION_MAX_AGE_HOURS=24
# Reaction-remove handler — fires when a user removes a reaction.
# Disabled by default; useful for workflows where un-reacting has meaning.
#DISCOCLAW_REACTION_REMOVE_HANDLER=0

# ----------------------------------------------------------
# Discord actions (let Claude manage your server)
# ----------------------------------------------------------
# Master switch — must be 1 for any action category to work.
# Enabling it unlocks the defer command below (and all other action categories).
#DISCOCLAW_DISCORD_ACTIONS=0
# Per-category flags (only active when master switch is 1):
#DISCOCLAW_DISCORD_ACTIONS_CHANNELS=1
#DISCOCLAW_DISCORD_ACTIONS_MESSAGING=0
#DISCOCLAW_DISCORD_ACTIONS_GUILD=0
#DISCOCLAW_DISCORD_ACTIONS_MODERATION=0
#DISCOCLAW_DISCORD_ACTIONS_POLLS=0
#DISCOCLAW_DISCORD_ACTIONS_BEADS=1
# Allow the AI to self-initiate forge runs (draft + audit loops) via action blocks.
# Requires DISCOCLAW_FORGE_COMMANDS_ENABLED=1. Only one forge at a time. Default: 0 (opt-in).
#DISCOCLAW_DISCORD_ACTIONS_FORGE=1
# Allow the AI to create, inspect, approve, run, and close plans via action blocks.
# Requires DISCOCLAW_PLAN_COMMANDS_ENABLED=1. Default: 0 (opt-in).
#DISCOCLAW_DISCORD_ACTIONS_PLAN=1
# Allow the AI to read/write durable memory (facts, preferences) via action blocks.
# Requires DISCOCLAW_DURABLE_MEMORY_ENABLED=1. Default: 0 (opt-in).
#DISCOCLAW_DISCORD_ACTIONS_MEMORY=1
# Allow the AI to change status, activity, and nickname at runtime.
#DISCOCLAW_DISCORD_ACTIONS_BOT_PROFILE=0

# Allow the AI to defer another invocation (e.g., "check on the forge run in 10 minutes").
# The scheduler enforces DISCOCLAW_DISCORD_ACTIONS=1, respects the requesting message's channel
# permissions, and prevents chaining by disabling defer during the follow-up run.
#DISCOCLAW_DISCORD_ACTIONS_DEFER=0
# Optional guard rails keep deferred invocations within safe bounds.
# Maximum delay (seconds) the scheduler will accept for defer commands (default: 1800 / 30 min).
#DISCOCLAW_DISCORD_ACTIONS_DEFER_MAX_DELAY_SECONDS=1800
# Maximum number of pending deferred invocations allowed at once (default: 5).
#DISCOCLAW_DISCORD_ACTIONS_DEFER_MAX_CONCURRENT=5

# ----------------------------------------------------------
# Memory & summaries
# ----------------------------------------------------------
# Rolling AI-generated summaries of past conversations.
#DISCOCLAW_SUMMARY_ENABLED=1
#DISCOCLAW_SUMMARY_MODEL=fast
#DISCOCLAW_SUMMARY_MAX_CHARS=2000
#DISCOCLAW_SUMMARY_EVERY_N_TURNS=5
# Durable per-user facts/preferences (manual via !memory commands).
#DISCOCLAW_DURABLE_MEMORY_ENABLED=1
#DISCOCLAW_DURABLE_INJECT_MAX_CHARS=2000
#DISCOCLAW_DURABLE_MAX_ITEMS=200
#DISCOCLAW_MEMORY_COMMANDS_ENABLED=1
# Cross-channel short-term memory (per-guild, per-user ring buffer).
# Records recent exchanges across public channels for cross-channel awareness.
#DISCOCLAW_SHORTTERM_MEMORY_ENABLED=0
#DISCOCLAW_SHORTTERM_MAX_ENTRIES=20
#DISCOCLAW_SHORTTERM_MAX_AGE_HOURS=6
#DISCOCLAW_SHORTTERM_INJECT_MAX_CHARS=1000
# Auto-extract notable facts from user messages into durable memory.
# Runs after rolling summary generation. Default on.
#DISCOCLAW_SUMMARY_TO_DURABLE_ENABLED=1
# Character budget for recent conversation history in prompts (0 = disabled).
#DISCOCLAW_MESSAGE_HISTORY_BUDGET=3000

# ----------------------------------------------------------
# Bot identity
# ----------------------------------------------------------
# Bot display name (server nickname). Falls back to workspace/IDENTITY.md name, then "Discoclaw".
#DISCOCLAW_BOT_NAME=
# Presence status on startup: online | idle | dnd | invisible (default: don't set)
#DISCOCLAW_BOT_STATUS=
# Activity text on startup (empty = no activity)
#DISCOCLAW_BOT_ACTIVITY=
# Activity type: Playing (default) | Listening | Watching | Competing | Custom
#DISCOCLAW_BOT_ACTIVITY_TYPE=Playing
# Avatar image: absolute file path or URL (applied once on startup; empty = don't change)
#DISCOCLAW_BOT_AVATAR=

# ----------------------------------------------------------
# Status & observability
# ----------------------------------------------------------
# Channel name or ID to post status embeds (bot online/offline, errors).
#DISCOCLAW_STATUS_CHANNEL=
# Enable health commands (`!health`, `!health verbose`) for allowlisted users.
#DISCOCLAW_HEALTH_COMMANDS_ENABLED=1
# Optional subset allowlist for `!health verbose` (comma/space-separated IDs).
# Empty = any allowlisted user can use verbose mode.
#DISCOCLAW_HEALTH_VERBOSE_ALLOWLIST=

# ----------------------------------------------------------
# Advanced / debug
# ----------------------------------------------------------
# Data root — if set, workspace defaults to $DISCOCLAW_DATA_DIR/workspace.
#DISCOCLAW_DATA_DIR=
# Content directory override.
#DISCOCLAW_CONTENT_DIR=
# Enable per-session runtime isolation.
#DISCOCLAW_RUNTIME_SESSIONS=1
# Path to claude CLI binary (if not on $PATH).
#CLAUDE_BIN=claude
# Forward Claude CLI stderr to Discord (useful for debugging).
#CLAUDE_ECHO_STDIO=0
# Pass --verbose to the Claude CLI for increased output detail.
# Requires CLAUDE_OUTPUT_FORMAT=stream-json (auto-disabled with text format).
#CLAUDE_VERBOSE=0
# Write Claude CLI debug logs to this file.
#CLAUDE_DEBUG_FILE=
# Skip slow MCP plugin init in headless/systemd contexts.
#CLAUDE_STRICT_MCP_CONFIG=1
# Dump resolved runtime config at startup.
#DISCOCLAW_DEBUG_RUNTIME=0
# Per-group working directories.
#GROUPS_DIR=
#USE_GROUP_DIR_CWD=0
# Tools available to the runtime (Glob, Grep, Write now included by default).
#RUNTIME_TOOLS=Bash,Read,Write,Edit,Glob,Grep,WebSearch,WebFetch
# Fallback model tier when primary is overloaded (concrete names accepted as passthrough).
#RUNTIME_FALLBACK_MODEL=fast
# Max USD spend per Claude CLI process. One-shot: per invocation.
# Multi-turn: per session lifetime (accumulates across turns). Recommend $5-10.
#RUNTIME_MAX_BUDGET_USD=5.00
# Append to Claude's system prompt (pre-loads PA identity, skips workspace PA file reads).
# Max 4000 chars. Condense SOUL.md + IDENTITY.md + USER.md + TOOLS.md content here.
# Note: Do not set this on first run before workspace/BOOTSTRAP.md has been consumed,
# as the skip logic also bypasses BOOTSTRAP.md loading.
#CLAUDE_APPEND_SYSTEM_PROMPT=
# Global cap on parallel runtime invocations across all Discord sessions (0 = unlimited).
#DISCOCLAW_MAX_CONCURRENT_INVOCATIONS=3
# Timeout for runtime invocations (ms).
#RUNTIME_TIMEOUT_MS=600000
# Stream stall detection: kill one-shot process if no stdout/stderr for this long (ms). 0 = disabled.
#DISCOCLAW_STREAM_STALL_TIMEOUT_MS=120000
# Stream stall warning: show user-visible warning in Discord after this many ms of no events. 0 = disabled.
# Enable DISCOCLAW_SESSION_SCANNING=1 for tool-aware stall suppression (warnings suppressed during tool execution).
#DISCOCLAW_STREAM_STALL_WARNING_MS=60000

# ----------------------------------------------------------
# Plan & Forge — AI-assisted planning and implementation
# ----------------------------------------------------------
# Enable/disable !plan and !forge commands.
#DISCOCLAW_PLAN_COMMANDS_ENABLED=1
#DISCOCLAW_FORGE_COMMANDS_ENABLED=1
# Phase decomposition for approved plans.
#PLAN_PHASES_ENABLED=1
# Max files per phase batch during decomposition.
#PLAN_PHASE_MAX_CONTEXT_FILES=5
# Per-phase execution timeout (ms). Default: 1800000 (30 min).
#PLAN_PHASE_TIMEOUT_MS=1800000
# Max audit-fix attempts per phase before marking failed.
#PLAN_PHASE_AUDIT_FIX_MAX=2
# Max draft-audit-revise loops before CAP_REACHED.
#FORGE_MAX_AUDIT_ROUNDS=5
# Model overrides for forge roles (fall back to RUNTIME_MODEL).
#FORGE_DRAFTER_MODEL=
#FORGE_AUDITOR_MODEL=
# Per-agent timeout within forge (ms).
#FORGE_TIMEOUT_MS=1800000
# Min interval between Discord progress message edits (ms).
#FORGE_PROGRESS_THROTTLE_MS=3000
# Post-forge CTA suggesting !plan approve + !plan run.
#FORGE_AUTO_IMPLEMENT=1

# ----------------------------------------------------------
# Multi-provider auditor
# ----------------------------------------------------------
# Route the forge auditor to a non-Claude runtime.
# Valid values: "codex" (Codex CLI), "openai" (OpenAI-compatible HTTP API).
#FORGE_AUDITOR_RUNTIME=codex

# --- Codex CLI adapter ---
# Path to the Codex CLI binary (default: codex).
#CODEX_BIN=codex
# Optional: isolate Codex state/sessions from ~/.codex (helps avoid stale rollout DB issues).
#CODEX_HOME=/absolute/path/to/.codex-home-discoclaw
# Default model for the Codex CLI adapter. Used when FORGE_AUDITOR_MODEL is not set.
#CODEX_MODEL=gpt-5.3-codex
# WARNING: disables Codex approval prompts and sandbox protections (full-access mode).
# Equivalent to passing --dangerously-bypass-approvals-and-sandbox to codex exec.
#CODEX_DANGEROUSLY_BYPASS_APPROVALS_AND_SANDBOX=0
# Disable Codex session persistence/resume (workaround for session DB issues).
#CODEX_DISABLE_SESSIONS=0

# --- OpenAI-compatible HTTP adapter ---
# API key for the OpenAI-compatible adapter. Required when FORGE_AUDITOR_RUNTIME=openai.
#OPENAI_API_KEY=
# Base URL (override for proxies, Azure OpenAI, Ollama, etc.).
#OPENAI_BASE_URL=https://api.openai.com/v1
# Default model when FORGE_AUDITOR_MODEL is not set.
#OPENAI_MODEL=gpt-4o

# ----------------------------------------------------------
# Browser automation (agent-browser)
# ----------------------------------------------------------
# Chromium path for agent-browser. Only needed if the bundled browser
# (from `agent-browser install`) doesn't work.
#AGENT_BROWSER_EXECUTABLE_PATH=/usr/bin/chromium-browser
